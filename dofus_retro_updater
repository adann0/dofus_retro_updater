#!/bin/bash

function update {
	sudo rm -rf "/usr/games/retro"
	python3 dofus_retro_updater.py
	sudo mv retro "/usr/games"
	add_desktop_shortcut	
}

function add_desktop_shortcut {
	echo "[+] Adding Desktop Shortcut Icon..."

	wget "https://github.com/adann0/dofus_retro_updater/raw/main/Dofus%20Retro.icns" -q
	sudo mv "Dofus Retro.icns" "/usr/games/retro"

	if ! [[ -f "/home/$USER/Desktop/Dofus Retro.desktop" ]] && ! [[ -f "/home/$USER/Bureau/Dofus Retro.desktop" ]]
	then
		if ! [[ -f "Dofus Retro.desktop" ]]
		then
			wget "https://github.com/adann0/dofus_retro_updater/raw/main/Dofus%20Retro.desktop" -q
		fi
		
		chmod +x "Dofus Retro.desktop"
		
		echo "[+] Look for the Desktop..."
		
		if [[ -d "/home/$USER/Desktop" ]]
		then
			mv "Dofus Retro.desktop" "/home/$USER/Desktop"
		elif [[ -d "/home/$USER/Bureau" ]]
		then
			mv "Dofus Retro.desktop" "/home/$USER/Bureau"
		else
			echo "[-] Unable to find your Desktop. You can move 'Dofus Retro.desktop' file to your Desktop if you want a Shortcut."
		fi
	fi

	echo "[+] OK."
}

function uninstall {
	echo "[+] Removing all files..."
	sudo rm -rf "/usr/games/retro"
	rm -rf "/home/$USER/.config/Dofus Retro"
	rm "/home/$USER/Desktop/Dofus Retro.desktop"
	rm "/home/$USER/Bureau/Dofus Retro.desktop"
	echo "[+] OK."
}

echo "*** DOFUS RETRO UPDATER for Linux ***"

if [[ $1 == "update" ]] 
then
	update
elif [[ $1 == "uninstall" ]]
then
	uninstall
else
	echo "USAGE: ./dofus_retro_updater [update|uninstall]"
	exit
fi

echo "[+] ALL DONE."